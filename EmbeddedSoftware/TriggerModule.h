#pragma once
#include <ctime>
#include "JSONModule.h"
#include "TDMSData.h"
#include <math.h>
#include <list>
using namespace std;
#pragma warning(disable : 4996)

//触发类型的定义：
//时间间隔触发、特定时间触发、幅值触发、幅值变化触发、速度触发、速度变化触发
enum TriggerType
{
	TIME_INTERVAL, TIME_SPECIFIC, AMPLITUDE, AMPLITUDE_CHANGE, SPEED, SPEED_CHANGE
};



typedef struct
{
	string triggerEventName;
	string siteName;
	string equipmentName;
	string dataWatchName;
	string eventFileName;
	double triggeredValue;
	string triggeredtime;
	string triggerRules;

}TriggerEventInfo;


class TriggerModule
{
public:
	TriggerModule();
	~TriggerModule();

	static void init_trigger_rules(const TriggerSettings triggerSettings[] , const int length);

	static bool getTriggerFlag() { return trigger_flag; }
	static void setTriggerFlag(bool state) { trigger_flag = state; }

	static TriggerEventInfo rule_check(const ChannelGroup channelGroup[], const int length);

	void method(const TriggerSettings trigger_item, const double* p_date, const int len);

private:

	//触发状态标志,true表示目前不在触发记录状态，可以执行触发；false表示当前已在触发记录了，不可再触发
	static volatile bool trigger_flag;

	//触发规则检查链表
	static list<TriggerSettings> trigger_rules_list;
	static list<double> trigger_last_vlues_list;            //和触发规则链表相对应

	static time_t last_trigger_time;

};


